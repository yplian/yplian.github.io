{"title":"图片格式转换","slug":"图片格式转换","date":"2021-06-13T14:14:46.000Z","updated":"2021-06-13T14:14:46.000Z","comments":true,"path":"api/articles/图片格式转换.json","excerpt":"图片canvas，file，blob，DataURL等格式转换。","covers":null,"content":"<p>图片canvas，file，blob，DataURL等格式转换。</p>\n<a id=\"more\"></a>\n<h2 id=\"file转base64\"><a href=\"#file转base64\" class=\"headerlink\" title=\"file转base64\"></a>file转base64</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>base<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"img\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 方法一：利用URL.createObjectURL() ==&gt;  blob:null/xxxxxx</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> $img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        file.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(e.target.files[<span class=\"number\">0</span>])</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> file = e.target.files[<span class=\"number\">0</span>]</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> fileUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(file)</span></span><br><span class=\"line\">            $img.src = fileUrl</span><br><span class=\"line\"><span class=\"javascript\">            img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">// 手动回收</span></span></span><br><span class=\"line\">                URL.revokeObjectURL(fileUrl)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 利用FileReader.readAsDataURL() ==&gt; data:image/jpeg;base64,xxxxxx</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> $img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        file.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(e.target.files[<span class=\"number\">0</span>])</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> file = e.target.files[<span class=\"number\">0</span>]</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">const</span> fr = <span class=\"keyword\">new</span> FileReader(file)</span></span><br><span class=\"line\">            fr.readAsDataURL(file)</span><br><span class=\"line\"><span class=\"javascript\">            fr.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                 $img.src = <span class=\"keyword\">this</span>.result</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"canvas转DataURL\"><a href=\"#canvas转DataURL\" class=\"headerlink\" title=\"canvas转DataURL\"></a>canvas转DataURL</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// toBlob(callback, type, quality)</span></span><br><span class=\"line\"><span class=\"comment\">// callback</span></span><br><span class=\"line\"><span class=\"comment\">// 回调函数，可获得一个单独的 Blob 对象参数。如果图像未被成功创建，可能会获得 null 值。</span></span><br><span class=\"line\"><span class=\"comment\">// type 可选</span></span><br><span class=\"line\"><span class=\"comment\">// DOMString 类型，指定图片格式，默认格式（未指定或不支持）为 image/png。</span></span><br><span class=\"line\"><span class=\"comment\">// quality 可选</span></span><br><span class=\"line\"><span class=\"comment\">// Number 类型，值在 0 与 1 之间，当请求图片格式为 image/jpeg 或者 image/webp 时用来指定图片展示质量。如果这个参数的值不在指定类型与范围之内，则使用默认值，其余参数将被忽略。</span></span><br><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>)</span>&#123;...&#125;, <span class=\"string\">\"image/jpeg\"</span>, <span class=\"number\">0.95</span>); <span class=\"comment\">// JPEG at 95%</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Blob对象显示图片\"><a href=\"#Blob对象显示图片\" class=\"headerlink\" title=\"Blob对象显示图片\"></a>Blob对象显示图片</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">blobObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> imgSrc = <span class=\"built_in\">window</span>.URL.createObjectURL(blobObj)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>).src = imgSrc</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"下载DataURL表示的图片\"><a href=\"#下载DataURL表示的图片\" class=\"headerlink\" title=\"下载DataURL表示的图片\"></a>下载DataURL表示的图片</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadImg</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> aLink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">    aLink.download = <span class=\"string\">'fileName.png'</span> <span class=\"comment\">// 文件名后缀需要和dataurl表示的相同，否则可能乱码</span></span><br><span class=\"line\">    aLink.href = dataUrl</span><br><span class=\"line\">    aLink.click()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"<h2 id=\"file转base64\"><a href=\"#file转base64\" class=\"headerlink\" title=\"file转base64\"></a>file转base64</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>base<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"img\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 方法一：利用URL.createObjectURL() ==&gt;  blob:null/xxxxxx</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> $img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        file.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(e.target.files[<span class=\"number\">0</span>])</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> file = e.target.files[<span class=\"number\">0</span>]</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> fileUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(file)</span></span><br><span class=\"line\">            $img.src = fileUrl</span><br><span class=\"line\"><span class=\"javascript\">            img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"comment\">// 手动回收</span></span></span><br><span class=\"line\">                URL.revokeObjectURL(fileUrl)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 利用FileReader.readAsDataURL() ==&gt; data:image/jpeg;base64,xxxxxx</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"keyword\">let</span> $img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>)</span></span><br><span class=\"line\"><span class=\"javascript\">        file.onchange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(e.target.files[<span class=\"number\">0</span>])</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">let</span> file = e.target.files[<span class=\"number\">0</span>]</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">const</span> fr = <span class=\"keyword\">new</span> FileReader(file)</span></span><br><span class=\"line\">            fr.readAsDataURL(file)</span><br><span class=\"line\"><span class=\"javascript\">            fr.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                 $img.src = <span class=\"keyword\">this</span>.result</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"canvas转DataURL\"><a href=\"#canvas转DataURL\" class=\"headerlink\" title=\"canvas转DataURL\"></a>canvas转DataURL</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// toBlob(callback, type, quality)</span></span><br><span class=\"line\"><span class=\"comment\">// callback</span></span><br><span class=\"line\"><span class=\"comment\">// 回调函数，可获得一个单独的 Blob 对象参数。如果图像未被成功创建，可能会获得 null 值。</span></span><br><span class=\"line\"><span class=\"comment\">// type 可选</span></span><br><span class=\"line\"><span class=\"comment\">// DOMString 类型，指定图片格式，默认格式（未指定或不支持）为 image/png。</span></span><br><span class=\"line\"><span class=\"comment\">// quality 可选</span></span><br><span class=\"line\"><span class=\"comment\">// Number 类型，值在 0 与 1 之间，当请求图片格式为 image/jpeg 或者 image/webp 时用来指定图片展示质量。如果这个参数的值不在指定类型与范围之内，则使用默认值，其余参数将被忽略。</span></span><br><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">blob</span>)</span>&#123;...&#125;, <span class=\"string\">\"image/jpeg\"</span>, <span class=\"number\">0.95</span>); <span class=\"comment\">// JPEG at 95%</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"Blob对象显示图片\"><a href=\"#Blob对象显示图片\" class=\"headerlink\" title=\"Blob对象显示图片\"></a>Blob对象显示图片</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">canvas.toBlob(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">blobObj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> imgSrc = <span class=\"built_in\">window</span>.URL.createObjectURL(blobObj)</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'img'</span>).src = imgSrc</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"下载DataURL表示的图片\"><a href=\"#下载DataURL表示的图片\" class=\"headerlink\" title=\"下载DataURL表示的图片\"></a>下载DataURL表示的图片</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">downloadImg</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> aLink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">    aLink.download = <span class=\"string\">'fileName.png'</span> <span class=\"comment\">// 文件名后缀需要和dataurl表示的相同，否则可能乱码</span></span><br><span class=\"line\">    aLink.href = dataUrl</span><br><span class=\"line\">    aLink.click()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":[],"tags":[{"name":"js","path":"api/tags/js.json"},{"name":"Image","path":"api/tags/Image.json"},{"name":"Canvas","path":"api/tags/Canvas.json"}]}