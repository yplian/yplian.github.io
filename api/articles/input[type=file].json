{"title":"input[type=file]","slug":"input[type=file]","date":"2017-09-08T16:00:00.000Z","updated":"2017-09-08T16:00:00.000Z","comments":true,"path":"api/articles/input[type=file].json","excerpt":"当使用input[type=file]上传图片功能时，通常有些问题。简要记录。<br>","covers":["../images/input_file_1.png"],"content":"<p>当使用input[type=file]上传图片功能时，通常有些问题。简要记录。<br><a id=\"more\"></a></p>\n<h2 id=\"html5上传类型\"><a href=\"#html5上传类型\" class=\"headerlink\" title=\"html5上传类型\"></a>html5上传类型</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- html5上传 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"video/*;capture=camcorder\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"audio/*;capture=microphone\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*;capture=camera\"</span>&gt;</span><span class=\"comment\">&lt;!-- 直接调用相机（测试安卓可以，iphone还是有相册） --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> /&gt;</span><span class=\"comment\">&lt;!-- 调用相机 图片或者相册 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">multiple</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> /&gt;</span><span class=\"comment\">&lt;!-- 调用相册 --&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"获取方式\"><a href=\"#获取方式\" class=\"headerlink\" title=\"获取方式\"></a>获取方式</h2><h3 id=\"window-URL-window-webkitURL\"><a href=\"#window-URL-window-webkitURL\" class=\"headerlink\" title=\"window.URL || window.webkitURL\"></a>window.URL || window.webkitURL</h3><p>Window.URL 属性返回一个对象，它提供了用于创建和管理对象URLs的静态方法。它也可以作为一个构造函数被调用来构造 URL 对象。</p>\n<p>该方法存目前属于实验特性，存在兼容性如下所示：</p>\n<p><img src=\"../images/input_file_1.png\" alt=\"兼容性\"></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">onchange</span>=<span class=\"string\">\"changeImg(this)\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">changeImg(file)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"built_in\">window</span>.URL || <span class=\"built_in\">window</span>.webkitURL;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(url.createObjectURL(file.files[<span class=\"number\">0</span>]));<span class=\"comment\">//files是一个选中的数组</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> img = <span class=\"keyword\">new</span> Image();<span class=\"comment\">//创建Image对象</span></span><br><span class=\"line\">  img.src = url.createObjectURL(file.files[<span class=\"number\">0</span>]);<span class=\"comment\">//创建Image的对象的url</span></span><br><span class=\"line\">  img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'height:'</span>+<span class=\"keyword\">this</span>.height+<span class=\"string\">'----width:'</span>+<span class=\"keyword\">this</span>.width)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"HTML5中的FileReader\"><a href=\"#HTML5中的FileReader\" class=\"headerlink\" title=\"HTML5中的FileReader\"></a>HTML5中的FileReader</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">onchange</span>=<span class=\"string\">\"checkImg(this)\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checkImg(file)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">  reader.readAsDataURL(file.files[<span class=\"number\">0</span>]);<span class=\"comment\">//将文件base64编码</span></span><br><span class=\"line\">  reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">      <span class=\"keyword\">let</span> filesize = file.files[<span class=\"number\">0</span>].size/<span class=\"number\">1024</span>;<span class=\"comment\">//转化bit ==&gt; KB</span></span><br><span class=\"line\">      img.src = e.target.result;<span class=\"comment\">//获取编码后的值,也可以用this.result获取</span></span><br><span class=\"line\">      img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> height = <span class=\"keyword\">this</span>.height;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> width = <span class=\"keyword\">this</span>.width;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(width!=<span class=\"number\">80</span> &amp;&amp; height!=<span class=\"number\">80</span>)&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'请上传80*80像素的图片'</span>);</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(filesize&gt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'请上传最大不超过100K的图片!'</span>);</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'符合要求！'</span>);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"简单封装jquery库\"><a href=\"#简单封装jquery库\" class=\"headerlink\" title=\"简单封装jquery库\"></a>简单封装jquery库</h2><p>实现jquery+html5+canvas实现图片、预览、压缩、上传。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</span><br><span class=\"line\">    $.fn.extend(&#123;</span><br><span class=\"line\">        aiiUpload:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">        </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> obj !=<span class=\"string\">\"object\"</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                alert(<span class=\"string\">'参数错误'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> imageWidth,imageHeight;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> base64;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_num=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> fileInput=$(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> fileInputId=fileInput.attr(<span class=\"string\">'id'</span>);</span><br><span class=\"line\">            createDoc(<span class=\"string\">'#'</span>+fileInputId,obj.method,obj.action);</span><br><span class=\"line\">            $(<span class=\"string\">'#aii_file'</span>).change(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(test(<span class=\"keyword\">this</span>.value)==<span class=\"literal\">false</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    alert(<span class=\"string\">'格式错误'</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> objUrl = getObjectURL(<span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (objUrl)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    imgBefore(objUrl,file_num);</span><br><span class=\"line\">                    render(objUrl,obj.max_h,obj.max_w,file_num);</span><br><span class=\"line\">                    file_num++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createDoc</span>(<span class=\"params\">objID,form_method,form_action</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> element=$(objID);</span><br><span class=\"line\">        element.append(<span class=\"string\">'&lt;ul class=\"viewList\"&gt;&lt;/ul&gt;'</span>).append(<span class=\"string\">'&lt;div class=\"fileBox\"&gt;&lt;input type=\"file\"  id=\"aii_file\" /&gt;&lt;div class=\"file_bg\"&gt;&lt;/div&gt;&lt;/div&gt;'</span>).append(<span class=\"string\">'&lt;form id=\"aii_upload_form\" method=\"'</span>+form_method+<span class=\"string\">'\" action=\"'</span>+form_action+<span class=\"string\">'\"&gt;&lt;/form&gt;'</span>).append(<span class=\"string\">'&lt;canvas id=\"canvas\"&gt;&lt;/canvas&gt;'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> regexp=<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(.JPEG|.jpeg|.JPG|.jpg|.GIF|.gif|.BMP|.bmp|.PNG|.png)$\"</span>,<span class=\"string\">'g'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> regexp.test(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\">src,MaximgW,MaximgH,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> image=<span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        image.onload=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">        </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> canvas=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(image.width&gt;image.height)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageWidth=MaximgW;</span><br><span class=\"line\">                imageHeight=MaximgH*(image.height/image.width);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(image.width&lt;image.height)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageHeight=MaximgH;</span><br><span class=\"line\">                imageWidth=MaximgW*(image.width/image.height);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageWidth=MaximgW;</span><br><span class=\"line\">                imageHeight=MaximgH;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            canvas.width=imageWidth;</span><br><span class=\"line\">            canvas.height=imageHeight;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> con=canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">            con.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</span><br><span class=\"line\">            con.drawImage(image,<span class=\"number\">0</span>,<span class=\"number\">0</span>,imageWidth,imageHeight);</span><br><span class=\"line\">            base64=canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>,<span class=\"number\">0.5</span>).substr(<span class=\"number\">22</span>);</span><br><span class=\"line\">            add_doc(base64,idnum);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        image.src=src;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">//建立一個可存取到該file的url</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getObjectURL</span>(<span class=\"params\">file</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.createObjectURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// basic</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.createObjectURL(file) ;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.URL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// mozilla(firefox)</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.URL.createObjectURL(file) ;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.webkitURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// webkit or chrome</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.webkitURL.createObjectURL(file) ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> url;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//预览</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">imgBefore</span>(<span class=\"params\">objUrl,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> li=<span class=\"string\">'&lt;li class=\"view\"&gt;&lt;img src=\"'</span>+objUrl+<span class=\"string\">'\" id=\"aiiImg_'</span>+idnum+<span class=\"string\">'\" idnum=\"'</span>+idnum+<span class=\"string\">'\" /&gt;&lt;div class=\"close\" onclick=\"img_remove(this);\"&gt;&lt;/div&gt;&lt;/li&gt;'</span></span><br><span class=\"line\">        $(<span class=\"string\">'.viewList'</span>).append(li);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img=$(<span class=\"string\">'#aiiImg_'</span>+idnum);</span><br><span class=\"line\">        <span class=\"comment\">//预览图片居中 填满 代码</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'asdfasdfasdf'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        img.load(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> imgw=img.width(),</span><br><span class=\"line\">                imgh=img.height();</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(imgw);</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(imgh);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(imgw&gt;imgh)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                img.css(<span class=\"string\">'height'</span>,<span class=\"string\">'100%'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'width'</span>,<span class=\"string\">'auto'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'marginLeft'</span>,-(img.width()-img.height())/<span class=\"number\">2</span>+<span class=\"string\">'px'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(imgw&lt;imgh)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                img.css(<span class=\"string\">'width'</span>,<span class=\"string\">'100%'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'height'</span>,<span class=\"string\">'auto'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'marginTop'</span>,-(img.height()-img.width())/<span class=\"number\">2</span>+<span class=\"string\">'px'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add_doc</span> (<span class=\"params\">base,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $(<span class=\"string\">'#aii_upload_form'</span>).append(<span class=\"string\">'&lt;input type=\"hidden\" name=\"img[]\" id=\"f_'</span>+idnum+<span class=\"string\">'\" value=\"'</span>+base+<span class=\"string\">'\"/&gt;'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)(jQuery);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">img_remove</span>(<span class=\"params\">element</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> num=$(element).prev().attr(<span class=\"string\">'idnum'</span>);</span><br><span class=\"line\">    $(element).parent().remove();</span><br><span class=\"line\">    $(<span class=\"string\">'#f_'</span>+num).remove();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'asdf'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">class</span>=<span class=\"string\">\"section\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"box\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color:red;\"</span>&gt;</span>*样式修改请参考aiiUpload.css<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 掉用方式 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    $(<span class=\"string\">'#box'</span>).aiiUpload(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        method:<span class=\"string\">'POST'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        action:<span class=\"string\">'form.php'</span>,</span></span><br><span class=\"line\">        max_h:300,</span><br><span class=\"line\">        max_w:300,</span><br><span class=\"line\"><span class=\"javascript\">        subText:<span class=\"string\">'上传图片'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        fileText:<span class=\"string\">'选择图片'</span></span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>参考链接<br><a href=\"https://segmentfault.com/a/1190000002535673\" target=\"_blank\" rel=\"noopener\">https://segmentfault.com/a/1190000002535673</a></p>\n","more":"</p>\n<h2 id=\"html5上传类型\"><a href=\"#html5上传类型\" class=\"headerlink\" title=\"html5上传类型\"></a>html5上传类型</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- html5上传 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"video/*;capture=camcorder\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"audio/*;capture=microphone\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*;capture=camera\"</span>&gt;</span><span class=\"comment\">&lt;!-- 直接调用相机（测试安卓可以，iphone还是有相册） --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> /&gt;</span><span class=\"comment\">&lt;!-- 调用相机 图片或者相册 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">multiple</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"image/*\"</span> /&gt;</span><span class=\"comment\">&lt;!-- 调用相册 --&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"获取方式\"><a href=\"#获取方式\" class=\"headerlink\" title=\"获取方式\"></a>获取方式</h2><h3 id=\"window-URL-window-webkitURL\"><a href=\"#window-URL-window-webkitURL\" class=\"headerlink\" title=\"window.URL || window.webkitURL\"></a>window.URL || window.webkitURL</h3><p>Window.URL 属性返回一个对象，它提供了用于创建和管理对象URLs的静态方法。它也可以作为一个构造函数被调用来构造 URL 对象。</p>\n<p>该方法存目前属于实验特性，存在兼容性如下所示：</p>\n<p><img src=\"../images/input_file_1.png\" alt=\"兼容性\"></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">onchange</span>=<span class=\"string\">\"changeImg(this)\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">changeImg(file)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> url = <span class=\"built_in\">window</span>.URL || <span class=\"built_in\">window</span>.webkitURL;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(url.createObjectURL(file.files[<span class=\"number\">0</span>]));<span class=\"comment\">//files是一个选中的数组</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> img = <span class=\"keyword\">new</span> Image();<span class=\"comment\">//创建Image对象</span></span><br><span class=\"line\">  img.src = url.createObjectURL(file.files[<span class=\"number\">0</span>]);<span class=\"comment\">//创建Image的对象的url</span></span><br><span class=\"line\">  img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">'height:'</span>+<span class=\"keyword\">this</span>.height+<span class=\"string\">'----width:'</span>+<span class=\"keyword\">this</span>.width)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"HTML5中的FileReader\"><a href=\"#HTML5中的FileReader\" class=\"headerlink\" title=\"HTML5中的FileReader\"></a>HTML5中的FileReader</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">onchange</span>=<span class=\"string\">\"checkImg(this)\"</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checkImg(file)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> reader = <span class=\"keyword\">new</span> FileReader();</span><br><span class=\"line\">  reader.readAsDataURL(file.files[<span class=\"number\">0</span>]);<span class=\"comment\">//将文件base64编码</span></span><br><span class=\"line\">  reader.onload = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">      <span class=\"keyword\">let</span> filesize = file.files[<span class=\"number\">0</span>].size/<span class=\"number\">1024</span>;<span class=\"comment\">//转化bit ==&gt; KB</span></span><br><span class=\"line\">      img.src = e.target.result;<span class=\"comment\">//获取编码后的值,也可以用this.result获取</span></span><br><span class=\"line\">      img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> height = <span class=\"keyword\">this</span>.height;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> width = <span class=\"keyword\">this</span>.width;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(width!=<span class=\"number\">80</span> &amp;&amp; height!=<span class=\"number\">80</span>)&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'请上传80*80像素的图片'</span>);</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(filesize&gt;<span class=\"number\">100</span>)&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'请上传最大不超过100K的图片!'</span>);</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">              <span class=\"built_in\">console</span>.log(<span class=\"string\">'符合要求！'</span>);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"简单封装jquery库\"><a href=\"#简单封装jquery库\" class=\"headerlink\" title=\"简单封装jquery库\"></a>简单封装jquery库</h2><p>实现jquery+html5+canvas实现图片、预览、压缩、上传。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$</span>)</span>&#123;</span><br><span class=\"line\">    $.fn.extend(&#123;</span><br><span class=\"line\">        aiiUpload:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>)</span></span><br><span class=\"line\"><span class=\"function\">        </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> obj !=<span class=\"string\">\"object\"</span>)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                alert(<span class=\"string\">'参数错误'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> imageWidth,imageHeight;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> base64;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> file_num=<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> fileInput=$(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> fileInputId=fileInput.attr(<span class=\"string\">'id'</span>);</span><br><span class=\"line\">            createDoc(<span class=\"string\">'#'</span>+fileInputId,obj.method,obj.action);</span><br><span class=\"line\">            $(<span class=\"string\">'#aii_file'</span>).change(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(test(<span class=\"keyword\">this</span>.value)==<span class=\"literal\">false</span>)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    alert(<span class=\"string\">'格式错误'</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> objUrl = getObjectURL(<span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (objUrl)</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    imgBefore(objUrl,file_num);</span><br><span class=\"line\">                    render(objUrl,obj.max_h,obj.max_w,file_num);</span><br><span class=\"line\">                    file_num++;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createDoc</span>(<span class=\"params\">objID,form_method,form_action</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> element=$(objID);</span><br><span class=\"line\">        element.append(<span class=\"string\">'&lt;ul class=\"viewList\"&gt;&lt;/ul&gt;'</span>).append(<span class=\"string\">'&lt;div class=\"fileBox\"&gt;&lt;input type=\"file\"  id=\"aii_file\" /&gt;&lt;div class=\"file_bg\"&gt;&lt;/div&gt;&lt;/div&gt;'</span>).append(<span class=\"string\">'&lt;form id=\"aii_upload_form\" method=\"'</span>+form_method+<span class=\"string\">'\" action=\"'</span>+form_action+<span class=\"string\">'\"&gt;&lt;/form&gt;'</span>).append(<span class=\"string\">'&lt;canvas id=\"canvas\"&gt;&lt;/canvas&gt;'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> regexp=<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">\"(.JPEG|.jpeg|.JPG|.jpg|.GIF|.gif|.BMP|.bmp|.PNG|.png)$\"</span>,<span class=\"string\">'g'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> regexp.test(value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\">src,MaximgW,MaximgH,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> image=<span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">        image.onload=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">        </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> canvas=<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(image.width&gt;image.height)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageWidth=MaximgW;</span><br><span class=\"line\">                imageHeight=MaximgH*(image.height/image.width);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(image.width&lt;image.height)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageHeight=MaximgH;</span><br><span class=\"line\">                imageWidth=MaximgW*(image.width/image.height);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                imageWidth=MaximgW;</span><br><span class=\"line\">                imageHeight=MaximgH;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            canvas.width=imageWidth;</span><br><span class=\"line\">            canvas.height=imageHeight;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> con=canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">            con.clearRect(<span class=\"number\">0</span>,<span class=\"number\">0</span>,canvas.width,canvas.height);</span><br><span class=\"line\">            con.drawImage(image,<span class=\"number\">0</span>,<span class=\"number\">0</span>,imageWidth,imageHeight);</span><br><span class=\"line\">            base64=canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>,<span class=\"number\">0.5</span>).substr(<span class=\"number\">22</span>);</span><br><span class=\"line\">            add_doc(base64,idnum);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        image.src=src;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"comment\">//建立一個可存取到該file的url</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getObjectURL</span>(<span class=\"params\">file</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"literal\">null</span> ;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.createObjectURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// basic</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.createObjectURL(file) ;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.URL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// mozilla(firefox)</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.URL.createObjectURL(file) ;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.webkitURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// webkit or chrome</span></span><br><span class=\"line\">            url = <span class=\"built_in\">window</span>.webkitURL.createObjectURL(file) ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> url;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//预览</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">imgBefore</span>(<span class=\"params\">objUrl,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> li=<span class=\"string\">'&lt;li class=\"view\"&gt;&lt;img src=\"'</span>+objUrl+<span class=\"string\">'\" id=\"aiiImg_'</span>+idnum+<span class=\"string\">'\" idnum=\"'</span>+idnum+<span class=\"string\">'\" /&gt;&lt;div class=\"close\" onclick=\"img_remove(this);\"&gt;&lt;/div&gt;&lt;/li&gt;'</span></span><br><span class=\"line\">        $(<span class=\"string\">'.viewList'</span>).append(li);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> img=$(<span class=\"string\">'#aiiImg_'</span>+idnum);</span><br><span class=\"line\">        <span class=\"comment\">//预览图片居中 填满 代码</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'asdfasdfasdf'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        img.load(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> imgw=img.width(),</span><br><span class=\"line\">                imgh=img.height();</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(imgw);</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(imgh);</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(imgw&gt;imgh)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                img.css(<span class=\"string\">'height'</span>,<span class=\"string\">'100%'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'width'</span>,<span class=\"string\">'auto'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'marginLeft'</span>,-(img.width()-img.height())/<span class=\"number\">2</span>+<span class=\"string\">'px'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(imgw&lt;imgh)</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                img.css(<span class=\"string\">'width'</span>,<span class=\"string\">'100%'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'height'</span>,<span class=\"string\">'auto'</span>);</span><br><span class=\"line\">                img.css(<span class=\"string\">'marginTop'</span>,-(img.height()-img.width())/<span class=\"number\">2</span>+<span class=\"string\">'px'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add_doc</span> (<span class=\"params\">base,idnum</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        $(<span class=\"string\">'#aii_upload_form'</span>).append(<span class=\"string\">'&lt;input type=\"hidden\" name=\"img[]\" id=\"f_'</span>+idnum+<span class=\"string\">'\" value=\"'</span>+base+<span class=\"string\">'\"/&gt;'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)(jQuery);</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">img_remove</span>(<span class=\"params\">element</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> num=$(element).prev().attr(<span class=\"string\">'idnum'</span>);</span><br><span class=\"line\">    $(element).parent().remove();</span><br><span class=\"line\">    $(<span class=\"string\">'#f_'</span>+num).remove();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'asdf'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">section</span> <span class=\"attr\">class</span>=<span class=\"string\">\"section\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"box\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color:red;\"</span>&gt;</span>*样式修改请参考aiiUpload.css<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">section</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 掉用方式 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    $(<span class=\"string\">'#box'</span>).aiiUpload(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        method:<span class=\"string\">'POST'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        action:<span class=\"string\">'form.php'</span>,</span></span><br><span class=\"line\">        max_h:300,</span><br><span class=\"line\">        max_w:300,</span><br><span class=\"line\"><span class=\"javascript\">        subText:<span class=\"string\">'上传图片'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        fileText:<span class=\"string\">'选择图片'</span></span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>参考链接<br><a href=\"https://segmentfault.com/a/1190000002535673\" target=\"_blank\" rel=\"noopener\">https://segmentfault.com/a/1190000002535673</a></p>","categories":[{"name":"html","path":"api/categories/html.json"}],"tags":[{"name":"js","path":"api/tags/js.json"},{"name":"html5","path":"api/tags/html5.json"},{"name":"上传","path":"api/tags/上传.json"},{"name":"文件","path":"api/tags/文件.json"}]}