{"title":"Cookie相关","slug":"Cookie相关","date":"2023-03-26T02:55:58.000Z","updated":"2023-03-26T02:55:58.000Z","comments":true,"path":"api/articles/Cookie相关.json","excerpt":"操作Cookie相关内容。<br>","covers":null,"content":"<p>操作<code>Cookie</code>相关内容。<br><a id=\"more\"></a></p>\n<h2 id=\"获取Cookie\"><a href=\"#获取Cookie\" class=\"headerlink\" title=\"获取Cookie\"></a>获取Cookie</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取cookie</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; coockiename</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;*&#125;  &#123;(string | undefined)&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookieValue</span>(<span class=\"params\">coockiename: <span class=\"built_in\">string</span></span>): <span class=\"title\">string</span> | <span class=\"title\">undefined</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> name = coockiename + <span class=\"string\">'='</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ca = <span class=\"built_in\">document</span>.cookie.split(<span class=\"string\">';'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> c = ca[i].trim();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (c.indexOf(name) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> c.substring(name.length, c.length);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置Cookie\"><a href=\"#设置Cookie\" class=\"headerlink\" title=\"设置Cookie\"></a>设置Cookie</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 设置cookie</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; name</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; val</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;number&#125; [expTime=365]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setCookieValue</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, val: <span class=\"built_in\">string</span>, expTime = 365</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 默认cookie有效期365天, 严格设置GTM格式</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">Date</span>.now() + expTime * <span class=\"number\">864e5</span>);</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.cookie = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>=<span class=\"subst\">$&#123;encodeURIComponent(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">    val</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">  )&#125;</span>;expires=<span class=\"subst\">$&#123;exp.toUTCString()&#125;</span>; path=/; domain=<span class=\"subst\">$&#123;getCookieDomain()&#125;</span>;`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"获取主域名\"><a href=\"#获取主域名\" class=\"headerlink\" title=\"获取主域名\"></a>获取主域名</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取主域名，如果域名是ip，直接返回 eg:www.baidu.com =&gt; .baidu.com</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; [hostName]</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;*&#125;  &#123;string&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookieDomain</span>(<span class=\"params\">hostName?: <span class=\"built_in\">string</span></span>): <span class=\"title\">string</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> initialHost: <span class=\"built_in\">string</span> = hostName || location.hostname;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> host: <span class=\"built_in\">string</span> = initialHost;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ip =</span><br><span class=\"line\">    /^(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])$/;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ip.test(initialHost) === <span class=\"literal\">true</span> || initialHost === <span class=\"string\">'localhost'</span>) <span class=\"keyword\">return</span> initialHost;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> regex = <span class=\"regexp\">/([^]*).*/</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> match: RegExpMatchArray | <span class=\"literal\">null</span> = initialHost.match(regex);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (match !== <span class=\"literal\">undefined</span> &amp;&amp; match !== <span class=\"literal\">null</span>) host = match[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (host !== <span class=\"literal\">undefined</span> &amp;&amp; host !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> strAry: <span class=\"built_in\">string</span>[] = host.split(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strAry.length &gt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      host = strAry.slice(<span class=\"number\">1</span>).join(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`.<span class=\"subst\">$&#123;host&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"</p>\n<h2 id=\"获取Cookie\"><a href=\"#获取Cookie\" class=\"headerlink\" title=\"获取Cookie\"></a>获取Cookie</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取cookie</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; coockiename</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;*&#125;  &#123;(string | undefined)&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookieValue</span>(<span class=\"params\">coockiename: <span class=\"built_in\">string</span></span>): <span class=\"title\">string</span> | <span class=\"title\">undefined</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> name = coockiename + <span class=\"string\">'='</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ca = <span class=\"built_in\">document</span>.cookie.split(<span class=\"string\">';'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> c = ca[i].trim();</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (c.indexOf(name) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> c.substring(name.length, c.length);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"设置Cookie\"><a href=\"#设置Cookie\" class=\"headerlink\" title=\"设置Cookie\"></a>设置Cookie</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 设置cookie</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; name</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; val</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;number&#125; [expTime=365]</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setCookieValue</span>(<span class=\"params\">name: <span class=\"built_in\">string</span>, val: <span class=\"built_in\">string</span>, expTime = 365</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 默认cookie有效期365天, 严格设置GTM格式</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> exp = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">Date</span>.now() + expTime * <span class=\"number\">864e5</span>);</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.cookie = <span class=\"string\">`<span class=\"subst\">$&#123;name&#125;</span>=<span class=\"subst\">$&#123;encodeURIComponent(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">    val</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">  )&#125;</span>;expires=<span class=\"subst\">$&#123;exp.toUTCString()&#125;</span>; path=/; domain=<span class=\"subst\">$&#123;getCookieDomain()&#125;</span>;`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"获取主域名\"><a href=\"#获取主域名\" class=\"headerlink\" title=\"获取主域名\"></a>获取主域名</h2><figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 获取主域名，如果域名是ip，直接返回 eg:www.baidu.com =&gt; .baidu.com</span></span><br><span class=\"line\"><span class=\"comment\"> * @export</span></span><br><span class=\"line\"><span class=\"comment\"> * @param &#123;string&#125; [hostName]</span></span><br><span class=\"line\"><span class=\"comment\"> * @return &#123;*&#125;  &#123;string&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCookieDomain</span>(<span class=\"params\">hostName?: <span class=\"built_in\">string</span></span>): <span class=\"title\">string</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> initialHost: <span class=\"built_in\">string</span> = hostName || location.hostname;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> host: <span class=\"built_in\">string</span> = initialHost;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ip =</span><br><span class=\"line\">    /^(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])\\\\.(\\\\d&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;|<span class=\"number\">1</span>\\\\d\\\\d|<span class=\"number\">2</span>[<span class=\"number\">0</span><span class=\"number\">-4</span>]\\\\d|<span class=\"number\">25</span>[<span class=\"number\">0</span><span class=\"number\">-5</span>])$/;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ip.test(initialHost) === <span class=\"literal\">true</span> || initialHost === <span class=\"string\">'localhost'</span>) <span class=\"keyword\">return</span> initialHost;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> regex = <span class=\"regexp\">/([^]*).*/</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> match: RegExpMatchArray | <span class=\"literal\">null</span> = initialHost.match(regex);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (match !== <span class=\"literal\">undefined</span> &amp;&amp; match !== <span class=\"literal\">null</span>) host = match[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (host !== <span class=\"literal\">undefined</span> &amp;&amp; host !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> strAry: <span class=\"built_in\">string</span>[] = host.split(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strAry.length &gt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      host = strAry.slice(<span class=\"number\">1</span>).join(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">`.<span class=\"subst\">$&#123;host&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":[],"tags":[]}