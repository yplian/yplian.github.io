{"title":"文件下载","slug":"文件下载","date":"2020-01-05T16:00:00.000Z","updated":"2020-01-05T16:00:00.000Z","comments":true,"path":"api/articles/文件下载.json","excerpt":"业务中常遇到前端下载文件的需求，简单汇总。<br>","covers":null,"content":"<p>业务中常遇到前端下载文件的需求，简单汇总。<br><a id=\"more\"></a></p>\n<h2 id=\"返回Blob下载表格\"><a href=\"#返回Blob下载表格\" class=\"headerlink\" title=\"返回Blob下载表格\"></a>返回Blob下载表格</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.$http.get(<span class=\"string\">'***'</span>, &#123;</span><br><span class=\"line\">    responseType: <span class=\"string\">'blob'</span></span><br><span class=\"line\">&#125;).then(data)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> blob = <span class=\"keyword\">new</span> Blob([data], &#123;</span><br><span class=\"line\">        type: <span class=\"string\">'application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.navigator.msSaveOrOpenBlob) &#123;</span><br><span class=\"line\">        navigator.msSaveBlob(blob)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> elink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">        elink.download = <span class=\"string\">`<span class=\"subst\">$&#123;fileName&#125;</span>.xls`</span></span><br><span class=\"line\">        elink.style.display = <span class=\"string\">'none'</span></span><br><span class=\"line\">        elink.href = URL.createObjectURL(blob)</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(elink)</span><br><span class=\"line\">        elink.click()</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.removeChild(elink)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"返回Blob下载pdf\"><a href=\"#返回Blob下载pdf\" class=\"headerlink\" title=\"返回Blob下载pdf\"></a>返回Blob下载pdf</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">let</span> blob = <span class=\"keyword\">new</span> Blob([data], &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'application/pdf;charset=UTF-8'</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.navigator.msSaveOrOpenBlob) &#123;</span><br><span class=\"line\">    navigator.msSaveBlob(blob);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> elink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    elink.download = <span class=\"string\">`<span class=\"subst\">$&#123;fileName&#125;</span>.pdf`</span>;</span><br><span class=\"line\">    elink.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    elink.href = URL.createObjectURL(blob);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(elink);</span><br><span class=\"line\">    elink.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(elink);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"返回url下载\"><a href=\"#返回url下载\" class=\"headerlink\" title=\"返回url下载\"></a>返回url下载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">..._URL...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// location.href</span></span><br><span class=\"line\">location.href = _URL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// window.open</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.open(_URL);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// iframe</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> iframe = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'iframe'</span>);</span><br><span class=\"line\">iframe.style.display = <span class=\"string\">'none'</span>; <span class=\"comment\">// 防止影响页面</span></span><br><span class=\"line\">iframe.style.height = <span class=\"number\">0</span>; <span class=\"comment\">// 防止影响页面</span></span><br><span class=\"line\">iframe.src = _URL;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(iframe);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">iframe.remove();</span><br><span class=\"line\">&#125;, <span class=\"number\">60</span> * <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// blob</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Req = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">Req.open(<span class=\"string\">'GET'</span>, _URL, <span class=\"literal\">true</span>);</span><br><span class=\"line\">Req.responseType = <span class=\"string\">'blob'</span>;</span><br><span class=\"line\">Req.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([Req.response], &#123;</span><br><span class=\"line\">        type: <span class=\"string\">'application/pdf'</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> type = blob.type;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> forceSaveableType = <span class=\"string\">'application/octet-stream'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type &amp;&amp; type !== forceSaveableType) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 强制下载，而非在浏览器中打开</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> slice = blob.slice || blob.webkitSlice || blob.mozSlice;</span><br><span class=\"line\">        blob = slice.call(blob, <span class=\"number\">0</span>, blob.size, forceSaveableType);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> saveLink = <span class=\"built_in\">document</span>.createElementNS(</span><br><span class=\"line\">        <span class=\"string\">'http://www.w3.org/1999/xhtml'</span>,</span><br><span class=\"line\">        <span class=\"string\">'a'</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    saveLink.href = url;</span><br><span class=\"line\">    saveLink.download = <span class=\"string\">'文件.pdf'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> event = <span class=\"keyword\">new</span> MouseEvent(<span class=\"string\">'click'</span>, &#123;</span><br><span class=\"line\">        bubbles: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        cancelable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        view: <span class=\"built_in\">window</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    saveLink.dispatchEvent(event);</span><br><span class=\"line\">    URL.revokeObjectURL(url);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Req.send();</span><br></pre></td></tr></table></figure>\n<h2 id=\"第三方\"><a href=\"#第三方\" class=\"headerlink\" title=\"第三方\"></a>第三方</h2><p>具体见文档<a href=\"https://github.com/rndme/download\" target=\"_blank\" rel=\"noopener\">https://github.com/rndme/download</a>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(<span class=\"string\">'文件.pdf'</span>)</span><br></pre></td></tr></table></figure>\n","more":"</p>\n<h2 id=\"返回Blob下载表格\"><a href=\"#返回Blob下载表格\" class=\"headerlink\" title=\"返回Blob下载表格\"></a>返回Blob下载表格</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.$http.get(<span class=\"string\">'***'</span>, &#123;</span><br><span class=\"line\">    responseType: <span class=\"string\">'blob'</span></span><br><span class=\"line\">&#125;).then(data)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> blob = <span class=\"keyword\">new</span> Blob([data], &#123;</span><br><span class=\"line\">        type: <span class=\"string\">'application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.navigator.msSaveOrOpenBlob) &#123;</span><br><span class=\"line\">        navigator.msSaveBlob(blob)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> elink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">        elink.download = <span class=\"string\">`<span class=\"subst\">$&#123;fileName&#125;</span>.xls`</span></span><br><span class=\"line\">        elink.style.display = <span class=\"string\">'none'</span></span><br><span class=\"line\">        elink.href = URL.createObjectURL(blob)</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.appendChild(elink)</span><br><span class=\"line\">        elink.click()</span><br><span class=\"line\">        <span class=\"built_in\">document</span>.body.removeChild(elink)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"返回Blob下载pdf\"><a href=\"#返回Blob下载pdf\" class=\"headerlink\" title=\"返回Blob下载pdf\"></a>返回Blob下载pdf</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">let</span> blob = <span class=\"keyword\">new</span> Blob([data], &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'application/pdf;charset=UTF-8'</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.navigator.msSaveOrOpenBlob) &#123;</span><br><span class=\"line\">    navigator.msSaveBlob(blob);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> elink = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">    elink.download = <span class=\"string\">`<span class=\"subst\">$&#123;fileName&#125;</span>.pdf`</span>;</span><br><span class=\"line\">    elink.style.display = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    elink.href = URL.createObjectURL(blob);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.appendChild(elink);</span><br><span class=\"line\">    elink.click();</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.body.removeChild(elink);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"返回url下载\"><a href=\"#返回url下载\" class=\"headerlink\" title=\"返回url下载\"></a>返回url下载</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">..._URL...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// location.href</span></span><br><span class=\"line\">location.href = _URL;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// window.open</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.open(_URL);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// iframe</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> iframe = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'iframe'</span>);</span><br><span class=\"line\">iframe.style.display = <span class=\"string\">'none'</span>; <span class=\"comment\">// 防止影响页面</span></span><br><span class=\"line\">iframe.style.height = <span class=\"number\">0</span>; <span class=\"comment\">// 防止影响页面</span></span><br><span class=\"line\">iframe.src = _URL;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(iframe);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">iframe.remove();</span><br><span class=\"line\">&#125;, <span class=\"number\">60</span> * <span class=\"number\">1000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// blob</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> Req = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">Req.open(<span class=\"string\">'GET'</span>, _URL, <span class=\"literal\">true</span>);</span><br><span class=\"line\">Req.responseType = <span class=\"string\">'blob'</span>;</span><br><span class=\"line\">Req.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> blob = <span class=\"keyword\">new</span> Blob([Req.response], &#123;</span><br><span class=\"line\">        type: <span class=\"string\">'application/pdf'</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> type = blob.type;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> forceSaveableType = <span class=\"string\">'application/octet-stream'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (type &amp;&amp; type !== forceSaveableType) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 强制下载，而非在浏览器中打开</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> slice = blob.slice || blob.webkitSlice || blob.mozSlice;</span><br><span class=\"line\">        blob = slice.call(blob, <span class=\"number\">0</span>, blob.size, forceSaveableType);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> saveLink = <span class=\"built_in\">document</span>.createElementNS(</span><br><span class=\"line\">        <span class=\"string\">'http://www.w3.org/1999/xhtml'</span>,</span><br><span class=\"line\">        <span class=\"string\">'a'</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">    saveLink.href = url;</span><br><span class=\"line\">    saveLink.download = <span class=\"string\">'文件.pdf'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> event = <span class=\"keyword\">new</span> MouseEvent(<span class=\"string\">'click'</span>, &#123;</span><br><span class=\"line\">        bubbles: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        cancelable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        view: <span class=\"built_in\">window</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    saveLink.dispatchEvent(event);</span><br><span class=\"line\">    URL.revokeObjectURL(url);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Req.send();</span><br></pre></td></tr></table></figure>\n<h2 id=\"第三方\"><a href=\"#第三方\" class=\"headerlink\" title=\"第三方\"></a>第三方</h2><p>具体见文档<a href=\"https://github.com/rndme/download\" target=\"_blank\" rel=\"noopener\">https://github.com/rndme/download</a>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">download(<span class=\"string\">'文件.pdf'</span>)</span><br></pre></td></tr></table></figure>","categories":[{"name":"js","path":"api/categories/js.json"}],"tags":[{"name":"文件","path":"api/tags/文件.json"},{"name":"vue","path":"api/tags/vue.json"},{"name":"Blob","path":"api/tags/Blob.json"}]}